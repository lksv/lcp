<div class="lcp-resource-show">
  <div class="lcp-header">
    <h1><%= @record.respond_to?(:to_label) ? @record.to_label : @record.to_s %></h1>
    <div class="lcp-toolbar">
      <%= render "lcp_ruby/resources/view_switcher" unless @record %>
      <%= link_to "Back to list", resources_path, class: "btn" %>
      <% @action_set.single_actions(@record).each do |action| %>
        <%= render "lcp_ruby/resources/action_button", action: action, record: @record, css_class: "btn" %>
      <% end %>
    </div>
  </div>

  <% if current_presenter.show_config["description"].present? %>
    <p class="lcp-view-description"><%= current_presenter.show_config["description"] %></p>
  <% end %>

  <% @layout_builder.show_sections.each do |section| %>
    <div class="lcp-section">
      <h2><%= section["section"] || section["title"] %></h2>
      <% if section["description"].present? %>
        <p class="lcp-section-description"><%= section["description"] %></p>
      <% end %>

      <% if section["type"] == "association_list" %>
        <%= render "lcp_ruby/resources/association_list",
                   section: section, record: @record %>
      <% else %>
        <div class="lcp-fields lcp-grid" style="display: grid; grid-template-columns: repeat(<%= section['columns'] || 1 %>, 1fr); gap: 1rem;"
             <%= "data-responsive-mobile=\"#{section.dig('responsive', 'mobile', 'columns')}\"" if section.dig('responsive', 'mobile', 'columns') %>
             <%= "data-responsive-tablet=\"#{section.dig('responsive', 'tablet', 'columns')}\"" if section.dig('responsive', 'tablet', 'columns') %>>
          <% visible_fields = @column_set.visible_show_fields(section["fields"]) %>
          <% visible_fields.each do |field_config| %>

            <% if field_config["type"] == "info" %>
              <div class="lcp-info-text" style="grid-column: 1 / -1;"><%= field_config["text"] %></div>
              <% next %>
            <% end %>

            <% field_name = field_config["field"] %>
            <% next unless field_name %>
            <% next unless @record.respond_to?(field_name) || field_name.include?(".") || field_name.include?("{") || field_config["custom_field"] %>
            <% value = @field_resolver.resolve(@record, field_name) %>

            <div class="lcp-field <%= hidden_on_classes(field_config) %>"
                 id="field-<%= field_name.to_s.tr('.', '-') %>"
                 <%= "style=\"grid-column: span #{field_config['col_span']}\"" if field_config["col_span"] %>>
              <% field_def = field_config["field_definition"] %>
              <label><%= field_config["label"] || field_def&.label || field_name.to_s.split(".").last.humanize %></label>
              <div class="lcp-field-value">
                <% if field_config["partial"] %>
                  <%= render partial: field_config["partial"], locals: { value: value, record: @record, options: field_config["options"] || {} } %>
                <% elsif field_config["renderer"] %>
                  <%= render_display_value(value, field_config["renderer"], field_config["options"], field_def, record: @record) %>
                <% elsif value.is_a?(Array) %>
                  <%= render_display_value(value, "collection", {}) %>
                <% else %>
                  <%= value %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
