<div class="lcp-resource-show">
  <div class="lcp-header">
    <h1><%= @record.respond_to?(:to_label) ? @record.to_label : @record.to_s %></h1>
    <div class="lcp-toolbar">
      <%= link_to "Back to list", resources_path, class: "btn" %>
      <% @action_set.single_actions(@record).each do |action| %>
        <% action = action.transform_keys(&:to_s) if action.is_a?(Hash) %>
        <% case action["name"] %>
        <% when "edit" %>
          <%= link_to "Edit", edit_resource_path(@record), class: "btn" %>
        <% when "destroy" %>
          <%= button_to "Delete", resource_path(@record),
                method: :delete,
                data: { turbo_confirm: action["confirm_message"] || "Are you sure?" },
                class: "btn btn-danger" %>
        <% end %>
      <% end %>
    </div>
  </div>

  <% @layout_builder.show_sections.each do |section| %>
    <div class="lcp-section">
      <h2><%= section["section"] || section["title"] %></h2>

      <% if section["type"] == "association_list" %>
        <% assoc_name = section["association"] %>
        <% if @record.respond_to?(assoc_name) %>
          <div class="lcp-association-list">
            <% @record.send(assoc_name).each do |assoc_record| %>
              <div class="lcp-association-item">
                <%= assoc_record.respond_to?(:to_label) ? assoc_record.to_label : assoc_record.to_s %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% else %>
        <div class="lcp-fields" style="display: grid; grid-template-columns: repeat(<%= section['columns'] || 1 %>, 1fr); gap: 1rem;">
          <% visible_fields = @column_set.visible_show_fields(section["fields"]) %>
          <% visible_fields.each do |field_config| %>
            <% field_config = field_config.transform_keys(&:to_s) if field_config.is_a?(Hash) %>
            <% field_name = field_config["field"] %>
            <% next unless @record.respond_to?(field_name) %>
            <% value = @record.send(field_name) %>

            <div class="lcp-field">
              <% field_def = field_config["field_definition"] %>
              <label><%= field_def&.label || field_name.humanize %></label>
              <div class="lcp-field-value">
                <% case field_config["display"] %>
                <% when "heading" %>
                  <strong><%= value %></strong>
                <% when "badge" %>
                  <span class="badge"><%= value %></span>
                <% when "link" %>
                  <% if value.respond_to?(:to_label) %>
                    <%= value.to_label %>
                  <% else %>
                    <%= value %>
                  <% end %>
                <% when "rich_text" %>
                  <div class="rich-text"><%= value&.html_safe %></div>
                <% when "currency" %>
                  <%= number_to_currency(value) %>
                <% when "relative_date" %>
                  <%= value.respond_to?(:strftime) ? time_ago_in_words(value) + " ago" : value %>
                <% else %>
                  <%= value %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
