<%= form_with(model: @record, url: @record.new_record? ? resources_path : resource_path(@record), scope: :record, method: @record.new_record? ? :post : :patch) do |form| %>
  <% if @record.errors.any? %>
    <div class="lcp-errors">
      <h3><%= pluralize(@record.errors.count, "error") %> prevented this record from being saved:</h3>
      <ul>
        <% @record.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <% sections = @layout_builder.form_sections %>
  <% if @layout_builder.form_layout == "tabs" %>
    <div class="lcp-tabs">
      <nav class="lcp-tab-nav">
        <% sections.each_with_index do |section, i| %>
          <% next if section["type"] == "nested_fields" && i != sections.index(section) %>
          <button type="button" data-lcp-tab="<%= i %>" class="btn <%= 'active' if i == 0 %>">
            <%= section["title"] %>
          </button>
        <% end %>
      </nav>
      <% sections.each_with_index do |section, i| %>
        <div data-lcp-panel="<%= i %>" style="<%= 'display:none' unless i == 0 %>">
          <%= render partial: "lcp_ruby/resources/form_section", locals: { form: form, section: section } %>
        </div>
      <% end %>
    </div>
  <% else %>
    <% sections.each do |section| %>
      <%= render partial: "lcp_ruby/resources/form_section", locals: { form: form, section: section } %>
    <% end %>
  <% end %>

  <div class="lcp-form-actions">
    <%= form.submit @record.new_record? ? "Create" : "Update", class: "btn btn-primary" %>
    <%= link_to "Cancel", resources_path, class: "btn" %>
  </div>
<% end %>
