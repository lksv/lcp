<!DOCTYPE html>
<html>
<head>
  <title>LCP Ruby</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <%= csrf_meta_tags %>
  <% if Rails.application.config.respond_to?(:assets) %>
    <%= stylesheet_link_tag "lcp_ruby/tom-select", media: "all" %>
    <%= stylesheet_link_tag "lcp_ruby/application", media: "all" %>
  <% end %>
</head>
<body>
  <nav class="lcp-nav">
    <ul class="lcp-nav-list">
      <% navigable_presenters.each do |entry| %>
        <li class="lcp-nav-item">
          <%= link_to entry[:label], lcp_ruby.resources_path(lcp_slug: entry[:slug]),
                class: entry[:all_slugs].include?(params[:lcp_slug]) ? "active" : "" %>
        </li>
      <% end %>
    </ul>
  </nav>
  <% if impersonating? %>
    <div class="lcp-impersonation-banner">
      <span>Viewing as role: <strong><%= impersonated_role %></strong></span>
      <%= button_to "Stop impersonation", lcp_ruby.stop_impersonate_path, method: :delete, class: "btn btn-danger" %>
    </div>
  <% elsif available_roles_for_impersonation.any? %>
    <div class="lcp-impersonation-banner lcp-impersonation-selector">
      <%= form_with url: lcp_ruby.impersonate_path, method: :post, style: "display: inline-flex; align-items: center; gap: 0.5rem;" do |f| %>
        <label for="impersonate_role">View as:</label>
        <%= select_tag :role, options_for_select(available_roles_for_impersonation), prompt: "Select role...", id: "impersonate_role" %>
        <%= submit_tag "Impersonate", class: "btn" %>
      <% end %>
    </div>
  <% end %>
  <div class="lcp-container">
    <% flash.each do |type, message| %>
      <div class="lcp-flash lcp-flash-<%= type %>"><%= message %></div>
    <% end %>
    <%= yield %>
  </div>

  <!-- Inline create dialog -->
  <dialog id="lcp-inline-create-dialog" class="lcp-inline-dialog">
    <h3 id="lcp-inline-dialog-title"></h3>
    <div class="lcp-dialog-errors" id="lcp-inline-dialog-errors"></div>
    <div id="lcp-inline-dialog-content"></div>
    <div class="lcp-dialog-actions">
      <button type="button" class="btn" id="lcp-inline-dialog-cancel"><%= I18n.t("lcp_ruby.form.cancel") %></button>
      <button type="button" class="btn btn-primary" id="lcp-inline-dialog-save"><%= I18n.t("lcp_ruby.form.create") %></button>
    </div>
  </dialog>

  <% if Rails.application.config.respond_to?(:assets) %>
    <%= javascript_include_tag "lcp_ruby/tom-select.base.min" %>
    <%= javascript_include_tag "lcp_ruby/activestorage.min" %>
    <%= javascript_include_tag "lcp_ruby/application" %>
  <% end %>
</body>
</html>
