model:
  name: deal
  label: "Deal"
  label_plural: "Deals"

  fields:
    - name: title
      type: string
      label: "Title"
      column_options:
        limit: 255
        "null": false
      validations:
        - type: presence

    - name: stage
      type: enum
      label: "Stage"
      enum_values:
        - { value: lead, label: "Lead" }
        - { value: qualified, label: "Qualified" }
        - { value: proposal, label: "Proposal" }
        - { value: negotiation, label: "Negotiation" }
        - { value: closed_won, label: "Closed Won" }
        - { value: closed_lost, label: "Closed Lost" }
      default: lead

    - name: value
      type: decimal
      label: "Value"
      column_options: { precision: 12, scale: 2 }
      validations:
        - type: numericality
          options: { greater_than_or_equal_to: 0, allow_nil: true }

  associations:
    - type: belongs_to
      name: company
      target_model: company
      foreign_key: company_id
      required: true
    - type: belongs_to
      name: contact
      target_model: contact
      foreign_key: contact_id
      required: false

  scopes:
    - name: open_deals
      where_not: { stage: ["closed_won", "closed_lost"] }
    - name: won
      where: { stage: "closed_won" }
    - name: lost
      where: { stage: "closed_lost" }

  events:
    - name: on_stage_change
      type: field_change
      field: stage

  options:
    timestamps: true
    label_method: title
