presenter:
  name: deal
  model: deal
  label: "Deals"
  slug: deals
  icon: dollar-sign

  index:
    default_view: table
    default_sort: { field: created_at, direction: desc }
    per_page: 25
    actions_position: dropdown
    table_columns:
      - { field: title, width: "25%", link_to: show, sortable: true, pinned: left }
      - { field: "company.name", label: "Company", width: "20%", sortable: true }
      - { field: stage, width: "15%", renderer: badge, sortable: true, hidden_on: mobile }
      - { field: value, width: "15%", renderer: currency, sortable: true, summary: sum }

  show:
    layout:
      - section: "Deal Information"
        columns: 2
        fields:
          - { field: title, renderer: heading }
          - { field: stage, renderer: badge }
          - { field: value, renderer: currency }
          - { field: "company.name", label: "Company", renderer: test_highlight }

  form:
    layout: tabs
    sections:
      - title: "Deal Details"
        columns: 2
        fields:
          - { field: title, placeholder: "Deal title...", autofocus: true }
          - { field: stage, input_type: select }
          - { field: value, input_type: number, prefix: "$", disable_when: { field: stage, operator: in, value: [closed_won, closed_lost] } }
          - field: company_id
            input_type: association_select
            input_options:
              sort: { name: asc }
              group_by: industry
          - field: contact_id
            input_type: association_select
            input_options:
              depends_on:
                field: company_id
                foreign_key: company_id
              sort: { last_name: asc }
              label_method: full_name
            visible_when: { field: stage, operator: not_in, value: [lead] }
      - title: "Metrics"
        collapsible: true
        collapsed: true
        visible_when: { field: stage, operator: not_eq, value: lead }
        fields:
          - { field: priority, input_type: slider, input_options: { min: 0, max: 100, step: 5, show_value: true } }
          - { field: progress, input_type: number, suffix: "%", readonly: true }
          - { field: featured, input_type: toggle }
          - { field: rating, input_type: rating, input_options: { max: 5 } }

  search:
    enabled: true
    searchable_fields: [title]
    placeholder: "Search deals..."
    predefined_filters:
      - { name: all, label: "All", default: true }
      - { name: open, label: "Open", scope: open_deals }
      - { name: won, label: "Won", scope: won }
      - { name: lost, label: "Lost", scope: lost }

  actions:
    collection:
      - { name: create, type: built_in, label: "New Deal", icon: plus }
    single:
      - { name: show, type: built_in, icon: eye }
      - { name: edit, type: built_in, icon: pencil }
      - name: close_won
        type: custom
        label: "Close as Won"
        icon: check-circle
        confirm: true
        confirm_message: "Mark this deal as won?"
        visible_when: { field: stage, operator: not_in, value: [closed_won, closed_lost] }
        disable_when: { field: value, operator: blank }
      - { name: destroy, type: built_in, icon: trash, confirm: true, style: danger }
